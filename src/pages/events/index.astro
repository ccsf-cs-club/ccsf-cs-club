---
import Layout from "../../layouts/Layout.astro";
import EventTabs from "../../components/EventTabs.astro";
import FeaturedEventHero from "../../components/FeaturedEventHero.astro";
import EventCardBeta from "../../components/EventCardBeta.astro";
import OngoingSessionCard from "../../components/OngoingSessionCard.astro";
import type { EventsData } from "../api/events";

// Fetch events data from API endpoint
const eventsResponse = await fetch(new URL('/api/events', Astro.url.origin));
const eventsData: EventsData = await eventsResponse.json();

const { featured, upcoming, campus } = eventsData;
---

<Layout title="Events - CS Club">
  <main class="min-h-screen bg-base-200">
    <div class="container mx-auto px-4 py-6 max-w-6xl">
      
      <!-- Page Header -->
      <header class="mb-6">
        <h1 class="text-3xl md:text-4xl font-bold text-base-content mb-3 text-center">
          Events
        </h1>
        <p class="text-base text-base-content/70 text-center max-w-2xl mx-auto">
          Join our vibrant community of learners, builders, and innovators. From workshops to hackathons, 
          there's always something exciting happening.
        </p>
      </header>

      <!-- Tab Navigation -->
      <EventTabs activeTab="all" />

      <!-- Featured Event Hero Section -->
      <section class="mb-8">
        <FeaturedEventHero 
          title={featured.title}
          description={featured.description}
          badges={featured.badges}
          call_to_action={featured.call_to_action}
          dateRange={featured.dateRange}
          illustration={featured.illustration}
        />
      </section>

      <!-- Main Events Grid -->
      <section class="mb-8">
        <h2 class="text-xl font-bold text-base-content mb-4">Upcoming Events</h2>
        <div class="masonry-grid">
          {upcoming.map((event) => (
            <div class="masonry-item">
              <EventCardBeta
                title={event.title}
                description={event.description}
                badge={event.badge}
                illustration={event.illustration}
                call_to_action={event.call_to_action}
                track={event.track}
              />
            </div>
          ))}
        </div>
      </section>

      <!-- Campus Events Strip -->
      <section class="mb-8">
        <h2 class="text-xl font-bold text-base-content mb-4">Campus Events</h2>
        <div class="grid gap-3 md:grid-cols-2">
          {campus.map((event) => (
            <OngoingSessionCard
              title={event.title}
              badge={event.badge}
              icon={event.icon}
              schedule={event.schedule}
              description={event.description}
            />
          ))}
        </div>
      </section>

    </div>
  </main>
</Layout>

<style>
  /* CSS Columns Masonry with proper alignment fix */
  .masonry-grid {
    column-count: 1;
    column-gap: 1rem;
    column-fill: balance;
  }

  @media (min-width: 640px) {
    .masonry-grid {
      column-count: 2;
    }
  }

  @media (min-width: 1024px) {
    .masonry-grid {
      column-count: 3;
    }
  }

  .masonry-item {
    break-inside: avoid;
    margin-bottom: 1rem;
    display: block; /* Changed from inline-block to block */
    width: 100%;
  }

  /* Remove any margin from the first item in the container */
  .masonry-item:first-child {
    margin-top: 0;
  }
</style>